!function(){"use strict";function t(e){return function(t){return n=typeof(t=t),(null===t?"null":"object"==n&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"==n&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":n)===e;var n}}function n(n){return function(t){return typeof t===n}}function o(t){return t=t.getParam("link_assume_external_targets",!1),Z(t)&&t?1:!O(t)||"http"!==t&&"https"!==t?0:t}function f(t){return t.getParam("target_list",!0)}function m(t){return t.getParam("rel_list",[],"array")}function g(t){return t.getParam("allow_unsafe_link_target",!1,"boolean")}function i(t){return function(){return t}}function e(){return A}function u(e){function t(){return o}function n(t){return t(e)}var r=i(e),o={fold:function(t,n){return n(e)},is:function(t){return e===t},isSome:N,isNone:C,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:t,orThunk:t,map:function(t){return u(t(e))},each:function(t){t(e)},bind:n,exists:n,forall:n,filter:function(t){return t(e)?o:A},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(t){return t.is(e)},equals_:function(t,n){return t.fold(C,function(t){return n(e,t)})}};return o}function l(t,n){for(var e=0;e<t.length;e++){var r=n(t[e],e);if(r.isSome())return r}return P.none()}function c(t,n){return t?P.some(n):P.none()}function r(t){return O(t.value)?t.value:""}function a(n){return void 0===n&&(n=r),function(t){return P.from(t).map(function(t){return it(t,n)})}}function s(t,n){return at.call(t,n)}function d(t,n){if(t.collapsed)return[];for(var t=t.cloneContents(),e=new ct(t.firstChild,t),r=[],o=t.firstChild;n(o)&&r.push(o),o=e.next(););return r}function U(t){return/^\w+:/i.test(t)}function B(t,n){function e(t){return t.filter(function(t){return-1===T.inArray(r,t)})}var r=["noopener"],t=t?t.split(/\s+/):[];return 0<(n=n?0<(n=e(n=t)).length?n.concat(r):r:e(t)).length?T.trim(n.sort().join(" ")):""}function q(t,n){return(n?n.innerText||n.textContent:t.getContent({format:"text"})).replace(/\uFEFF/g,"")}function I(t){return 0<T.grep(t,ft).length}function K(t){var n=t.schema.getTextInlineElements();return 0===d(t.selection.getRng(),function(t){return 1===t.nodeType&&!st(t)&&!s(n,t.nodeName.toLowerCase())}).length}function z(e,t){return l(t,function(t){return s(n=n=t,"items")&&void 0!==n.items&&null!==n.items?z(e,t.items):c(t.value===e,t);var n})}function j(t){var n=t.href;return 0<n.indexOf("@")&&-1===n.indexOf("/")&&-1===n.indexOf("mailto:")?P.some({message:"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",preprocess:function(t){return _(_({},t),{href:"mailto:"+n})}}):P.none()}function V(t){return t=t.dom.select("a:not([href])"),0<(t=ot(function(t,n){for(var e=t.length,r=new Array(e),o=0;o<e;o++){var i=t[o];r[o]=n(i,o)}return r}(t,function(t){t=t.name||t.id;return t?[{text:t,value:"#"+t}]:[]}))).length?P.some([{text:"None",value:""}].concat(t)):P.none()}function F(n){function e(t){return n.convertURL(t.value||t.url,"href")}var t=n.getParam("link_list");return new M(function(n){O(t)?xt.send({url:t,success:function(t){return n(function(t){try{return P.some(JSON.parse(t))}catch(t){return P.none()}}(t))},error:function(t){return n(P.none())}}):tt(t)?t(function(t){return n(P.some(t))}):n(P.from(t))}).then(function(t){return t.bind(S.sanitizeWith(e)).map(function(t){return 0<t.length?[{text:"None",value:""}].concat(t):t})})}function h(t,n,e){return null!==(t=t.getAttrib(n,e))&&0<t.length?P.some(t):P.none()}function W(t){return Ct(t,t.selection.getStart())}function p(t,n){var e;n&&(e=R(n),/^#/.test(e)?(e=t.$(e)).length&&t.selection.scrollIntoView(e[0],!0):wt(n.href))}function v(e){return function(){var s,t,n;n=D(t=s=e),Ot(t,n).then(function(t){var o,i,n=function(t){var n,e,r=t.getData();r.url.value?(n={href:r.url.value,text:(n=function(n){return P.from(r[n]).filter(function(t){return!i.anchor[n].is(t)})})("text"),target:n("target"),rel:n("rel"),class:n("linkClass"),title:n("title")},e={href:r.url.value,attach:void 0!==r.url.meta&&r.url.meta.attach?r.url.meta.attach:w},kt(o,n).then(function(t){dt(o,e,t)})):E(o),t.close()},e=o=s,r=(t=i=t).anchor.text.map(function(){return{name:"text",type:"input",label:"Text to display"}}).toArray(),u=t.flags.titleEnabled?[{name:"title",type:"input",label:"Title"}]:[],e=P.from(nt(e)),a=t.anchor,l={url:{value:l=a.url.getOr(""),meta:{original:{value:l}}},text:a.text.getOr(""),title:a.title.getOr(""),anchor:l,link:l,rel:a.rel.getOr(""),target:a.target.or(e).getOr(""),linkClass:a.linkClass.getOr("")},e=t.catalogs,c=vt(l,e);return{title:"Insert/Edit Link",size:"normal",body:{type:"panel",items:ot([[{name:"url",type:"urlinput",filetype:"file",label:"URL"}],r,u,function(t){for(var n=[],e=function(t){n.push(t)},r=0;r<t.length;r++)t[r].each(e);return n}([e.anchor.map(S.createUi("anchor","Anchors")),e.rels.map(S.createUi("rel","Rel")),e.targets.map(S.createUi("target","Open link in...")),e.link.map(S.createUi("link","Link list")),e.classes.map(S.createUi("linkClass","Class"))])])},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:l,onChange:function(n,t){t=t.name;c.onChange(n.getData,{name:t}).each(function(t){n.setData(t)})},onSubmit:n}}).then(function(t){s.windowManager.open(t)})}}function y(t){return function(){p(t,W(t))}}function k(t,n){return t.on("NodeChange",n),function(){return t.off("NodeChange",n)}}function x(n){return function(t){return k(n,function(){t.setActive(!n.mode.isReadOnly()&&null!==D(n,n.selection.getNode()))})}}function H(e){return function(t){function n(){return t.setDisabled(null===D(e,e.selection.getNode()))}return n(),k(e,n)}}function G(r){return function(n){function e(t){return I(t)||(t=r.selection.getRng(),0<d(t,ft).length)}var t=r.dom.getParents(r.selection.getStart());return n.setDisabled(!e(t)),k(r,function(t){return n.setDisabled(!e(t.parents))})}}var J,X,b,$=tinymce.util.Tools.resolve("tinymce.PluginManager"),Q=tinymce.util.Tools.resolve("tinymce.util.VK"),O=t("string"),Y=t("array"),Z=n("boolean"),tt=n("function"),nt=function(t){return t.getParam("default_link_target")},w=function(){},C=i(!1),N=i(!(J=null)),A={fold:function(t,n){return t()},is:C,isSome:C,isNone:N,getOr:b=function(t){return t},getOrThunk:X=function(t){return t()},getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:i(null),getOrUndefined:i(void 0),or:b,orThunk:X,map:e,each:w,bind:e,exists:C,forall:N,filter:e,equals:b=function(t){return t.isNone()},equals_:b,toArray:function(){return[]},toString:i("none()")},P={some:u,none:e,from:function(t){return null==t?A:u(t)}},et=Array.prototype.indexOf,rt=Array.prototype.push,ot=function(t){for(var n=[],e=0,r=t.length;e<r;++e){if(!Y(t[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+t);rt.apply(n,t[e])}return n},T=tinymce.util.Tools.resolve("tinymce.util.Tools"),it=function(t,r){var o=[];return T.each(t,function(t){var n,e=O((e=t).text)?e.text:O(e.title)?e.title:"";void 0!==t.menu?(n=it(t.menu,r),o.push({text:e,items:n})):(n=r(t),o.push({text:e,value:n}))}),o},S={sanitize:function(t){return a(r)(t)},sanitizeWith:a,createUi:function(n,e){return function(t){return{name:n,type:"listbox",label:e,items:t}}},getValue:r},_=function(){return(_=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},ut=Object.keys,at=Object.hasOwnProperty,lt=function(t,n,e,r){for(var o,i=t,u=ut(i),a=0,l=u.length;a<l;a++){var c=u[a];o=i[c],(n(o,c=c)?e:r)(o,c)}return{}},ct=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),st=function(t){return t&&"a"===t.nodeName.toLowerCase()},ft=function(t){return st(t)&&!!R(t)},R=function(t){return t.getAttribute("data-mce-href")||t.getAttribute("href")},D=function(t,n){return n=n||t.selection.getNode(),L(n)?t.dom.select("a[href]",n)[0]:t.dom.getParent(n,"a[href]")},L=function(t){return t&&"FIGURE"===t.nodeName&&/\bimage\b/i.test(t.className)},mt=function(t){for(var n,e,n=function(n,e){return t[e].each(function(t){n[e]=0<t.length?t:null}),n},e={href:t.href},r=["title","rel","class","target"],o=0,i=r.length;o<i;o++)e=n(e,r[o]);return e},gt=function(t,n){var e,n=_({},n);return 0<m(t).length||!1!==g(t)||(e=B(n.rel,"_blank"===n.target),n.rel=e||null),P.from(n.target).isNone()&&!1===f(t)&&(n.target=nt(t)),n.href=(e=n.href,"http"!==(t=o(t))&&"https"!==t||U(e)?e:t+"://"+e),n},dt=function(t,n,e){var r,o,i,u,a,l,c,s,f,m,g,d,h;t.hasPlugin("rtc",!0)?t.execCommand("createlink",!1,(g=e.class,h=e.href,r=e.rel,o=e.target,i=e.text,u=e.title,g={class:g.getOrNull(),href:h,rel:r.getOrNull(),target:o.getOrNull(),text:i.getOrNull(),title:u.getOrNull()},lt(g,function(t,n){return!1==(J===t)},(d=h={},function(t,n){d[n]=t}),w),h)):(l=n,c=e,s=(a=t).selection.getNode(),f=D(a,s),m=gt(a,mt(c)),a.undoManager.transact(function(){var n,e,t,r,o,i;c.href===l.href&&l.attach(),f?(a.focus(),t=a,r=f,o=c.text,i=m,o.each(function(t){r.hasOwnProperty("innerText")?r.innerText=t:r.textContent=t}),t.dom.setAttribs(r,i),t.selection.select(r)):(n=a,o=c.text,e=m,L(i=s)?pt(n,i,e):o.fold(function(){n.execCommand("mceInsertLink",!1,e)},function(t){n.insertContent(n.dom.createHTML("a",e,n.dom.encode(t)))}))}))},E=function(t){var u;t.hasPlugin("rtc",!0)?t.execCommand("unlink"):(u=t).undoManager.transact(function(){var t,n,e,r,o,i=u.selection.getNode();L(i)?ht(u,i):(o=(i=u).dom,n=(t=i.selection).getBookmark(),e=t.getRng().cloneRange(),r=o.getParent(e.startContainer,"a[href]",i.getBody()),o=o.getParent(e.endContainer,"a[href]",i.getBody()),r&&e.setStartBefore(r),o&&e.setEndAfter(o),t.setRng(e),i.execCommand("unlink"),t.moveToBookmark(n)),u.focus()})},ht=function(t,n){var e=t.dom.select("img",n)[0];e&&(n=t.dom.getParents(e,"a[href]",n)[0])&&(n.parentNode.insertBefore(e,n),t.dom.remove(n))},pt=function(t,n,e){n=t.dom.select("img",n)[0];n&&(t=t.dom.create("a",e),n.parentNode.insertBefore(t,n),t.appendChild(n))},vt=function(t,i){function u(t,n){var e,r,o=("link"===(o=n.name)?i.link:"anchor"===o?i.anchor:P.none()).getOr([]);return e=a.text,n=n.name,o=o,t=(t=t)[n],r=0<e.length,void 0!==t?z(t,o).map(function(t){return{url:{value:t.value,meta:{text:r?e:t.text,attach:w}},text:r?e:t.text}}):P.none()}var a={text:t.text,title:t.title};return{onChange:function(t,n){var e,r,o=n.name;return"url"===o?(e=t(),r=e.url,r=c(a.text.length<=0,P.from(r.meta.text).getOr(r.value)),e=e.url,e=c(a.title.length<=0,P.from(e.meta.title).getOr("")),r.isSome()||e.isSome()?P.some(_(_({},r.map(function(t){return{text:t}}).getOr({})),e.map(function(t){return{title:t}}).getOr({}))):P.none()):(r=["anchor","link"],-1<et.call(r,o)?u(t(),n):("text"!==o&&"title"!==o||(a[o]=t()[o]),P.none()))}}},yt=tinymce.util.Tools.resolve("tinymce.util.Delay"),M=tinymce.util.Tools.resolve("tinymce.util.Promise"),kt=function(u,a){return l([j,(e=o(u),r=u.getParam("link_default_protocol","http","string"),function(t){var n=t.href;return 1===e&&!U(n)||0===e&&/^\s*www(\.|\d\.)/i.test(n)?P.some({message:"The URL you entered seems to be an external link. Do you want to add the required "+r+":// prefix?",preprocess:function(t){return _(_({},t),{href:r+"://"+n})}}):P.none()})],function(t){return t(a)}).fold(function(){return M.resolve(a)},function(i){return new M(function(n){var e=u,t=i.message,r=function(t){n(t?i.preprocess(a):a)},o=e.selection.getRng();yt.setEditorTimeout(e,function(){e.windowManager.confirm(t,function(t){e.selection.setRng(o),r(t)})})})});var e,r},xt=tinymce.util.Tools.resolve("tinymce.util.XHR"),bt=[{text:"Current window",value:""},{text:"New window",value:"_blank"}],Ot=function(c,s){return F(c).then(function(t){a=s,o=(i=c).dom,i=K(i)?P.some(q(i.selection,a)):P.none(),l=a?P.some(o.getAttrib(a,"href")):P.none(),n=a?P.from(o.getAttrib(a,"target")):P.none(),e=h(o,a,"rel"),r=h(o,a,"class");var n,e,r,o,i,u,a,l={url:l,text:i,title:h(o,a,"title"),target:n,rel:e,linkClass:r};return{anchor:l,catalogs:{targets:function(t){t=f(t);return Y(t)?S.sanitize(t).orThunk(function(){return P.some(bt)}):!1===t?P.none():P.some(bt)}(c),rels:(i=l.target,0<(a=m(o=c)).length?(u=i.is("_blank"),(!1===g(o)?S.sanitizeWith(function(t){return B(S.getValue(t),u)}):S.sanitize)(a)):P.none()),classes:function(t){t=t.getParam("link_class_list",[],"array");return 0<t.length?S.sanitize(t):P.none()}(c),anchor:V(c),link:t},optNode:P.from(s),flags:{titleEnabled:c.getParam("link_title",!0,"boolean")}}})},wt=function(t){var n=document.createElement("a");n.target="_blank",n.href=t,n.rel="noreferrer noopener";var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),n=n,t=t,document.body.appendChild(n),n.dispatchEvent(t),document.body.removeChild(n)},Ct=function(t,n){return t.dom.getParent(n,"a[href]")};$.add("link",function(t){var n,e,r,i,o,u,a,l;(n=t).ui.registry.addToggleButton("link",{icon:"link",tooltip:"Insert/edit link",onAction:v(n),onSetup:x(n)}),n.ui.registry.addButton("openlink",{icon:"new-tab",tooltip:"Open link",onAction:y(n),onSetup:H(n)}),n.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:function(){return E(n)},onSetup:G(n)}),(e=t).ui.registry.addMenuItem("openlink",{text:"Open link",icon:"new-tab",onAction:y(e),onSetup:H(e)}),e.ui.registry.addMenuItem("link",{icon:"link",text:"Link...",shortcut:"Meta+K",onAction:v(e)}),e.ui.registry.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onAction:function(){return E(e)},onSetup:G(e)}),(r=t).ui.registry.addContextMenu("link",{update:function(t){return I(r.dom.getParents(t,"a"))?"link unlink openlink":"link"}}),(i=t).ui.registry.addContextForm("quicklink",{launch:{type:"contextformtogglebutton",icon:"link",tooltip:"Link",onSetup:x(i)},label:"Link",predicate:function(t){return!!D(i,t)&&i.getParam("link_context_toolbar",!1,"boolean")},initValue:function(){var t=D(i);return t?R(t):""},commands:[{type:"contextformtogglebutton",icon:"link",tooltip:"Link",primary:!0,onSetup:function(t){var n=i.selection.getNode();return t.setActive(!!D(i,n)),x(i)(t)},onAction:function(t){var n,e,r=D(i),o=t.getValue();r?i.undoManager.transact(function(){i.dom.setAttrib(r,"href",o),i.selection.collapse(!1),t.hide()}):(n={href:o,attach:w},e=K(i)?P.some(q(i.selection,r)).filter(function(t){return 0<t.length}).or(P.from(o)):P.none(),dt(i,n,{href:o,text:e,title:P.none(),rel:P.none(),target:P.none(),class:P.none()}),t.hide())}},{type:"contextformbutton",icon:"unlink",tooltip:"Remove link",onSetup:o=function(t){var n=i.selection.getNode();return t.setDisabled(!D(i,n)),w},onAction:function(t){E(i),t.hide()}},{type:"contextformbutton",icon:"new-tab",tooltip:"Open link",onSetup:o,onAction:function(t){y(i)(),t.hide()}}]}),(l=t).on("click",function(t){var n=Ct(l,t.target);n&&Q.metaKeyPressed(t)&&(t.preventDefault(),p(l,n))}),l.on("keydown",function(t){var n=W(l);n&&13===t.keyCode&&!0===t.altKey&&!1===t.shiftKey&&!1===t.ctrlKey&&!1===t.metaKey&&(t.preventDefault(),p(l,n))}),(u=t).addCommand("mceLink",function(){u.getParam("link_quicklink",!1,"boolean")?u.fire("contexttoolbar-show",{toolbarKey:"quicklink"}):v(u)()}),(a=t).addShortcut("Meta+K","",function(){a.execCommand("mceLink")})})}();