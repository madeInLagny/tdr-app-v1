!function(){"use strict";function n(t){return function(n){return typeof n===t}}function t(){return T}function o(n,t){for(var e=O(n),o=0,r=e.length;o<r;o++){var i=e[o];t(n[i],i)}}function e(n,t,e){var o,r,n=n.dom;if(r=typeof(o=o=e),"string"!=(null===o?"null":"object"==r&&(Array.prototype.isPrototypeOf(o)||o.constructor&&"Array"===o.constructor.name)?"array":"object"==r&&(String.prototype.isPrototypeOf(o)||o.constructor&&"String"===o.constructor.name)?"string":r)&&!p(e)&&!y(e))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",e,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(t,e+"")}function r(n,t){n.dom.removeAttribute(t)}function u(n,t){return void 0===(t=null===(n=n.dom.getAttribute(t))?void 0:n)||""===t?[]:t.split(" ")}function i(n){if(null==n)throw new Error("Node cannot be null or undefined");return{dom:n}}function c(n,t){var e="";return o(n,function(n,t){e+=t}),new RegExp("["+e+"]",t?"g":"")}function f(n){var t=n.getBody(),e=n.selection.getBookmark(),o=void 0!==(o=function(n,t){for(;n.parentNode;){if(n.parentNode===t)return n;n=n.parentNode}}(n.selection.getNode(),t))?o:t;_(n,o),P(n,o),n.selection.moveToBookmark(e)}function d(n,t){var e=n,o=t.get(),e=(e.fire("VisualChars",{state:o}),n.getBody());(!0===t.get()?P:_)(n,e)}function m(o,r){o.addCommand("mceVisualChars",function(){var n,t,e;n=o,(t=r).set(!t.get()),e=n.selection.getBookmark(),d(n,t),n.selection.moveToBookmark(e)})}function g(e,o){return function(t){t.setActive(o.get());function n(n){return t.setActive(n.state)}return e.on("VisualChars",n),function(){return e.off("VisualChars",n)}}}var a,s,l,v,h=tinymce.util.Tools.resolve("tinymce.PluginManager"),p=n("boolean"),y=n("number"),b=function(n){return function(){return n}},w=b(!"string"),N=b(!0),T=(a=function(n){return n.isNone()},{fold:function(n,t){return n()},is:w,isSome:w,isNone:N,getOr:l=function(n){return n},getOrThunk:s=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:b(null),getOrUndefined:b(void 0),or:l,orThunk:s,map:t,each:function(){},bind:t,exists:w,forall:N,filter:t,equals:a,equals_:a,toArray:function(){return[]},toString:b("none()")}),k=function(e){function n(){return r}function t(n){return n(e)}var o=b(e),r={fold:function(n,t){return t(e)},is:function(n){return e===n},isSome:N,isNone:w,getOr:o,getOrThunk:o,getOrDie:o,getOrNull:o,getOrUndefined:o,or:n,orThunk:n,map:function(n){return k(n(e))},each:function(n){n(e)},bind:t,exists:t,forall:t,filter:function(n){return n(e)?r:T},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(n){return n.is(e)},equals_:function(n,t){return n.fold(w,function(n){return t(e,n)})}};return r},A=function(n,t){for(var e=0,o=n.length;e<o;e++)t(n[e],e)},O=Object.keys,C=("undefined"==typeof window&&Function("return this;")(),function(n){return n.dom.nodeValue}),S=function(n){return void 0!==n.dom.classList},D=function(n,t){return t=t,t=u(n=n,"class").concat([t]),e(n,"class",t.join(" ")),!0},j=function(n,t){return i=t,0<(n=function(n){for(var t=[],e=0,o=n.length;e<o;e++){var r=n[e];r!==i&&t.push(r)}return t}(u(t=n,"class"))).length?e(t,"class",n.join(" ")):r(t,"class"),!1;var i},M=function(n){0===(S(n)?n.dom.classList:u(n,"class")).length&&r(n,"class")},E={fromHtml:function(n,t){t=(t||document).createElement("div");if(t.innerHTML=n,!t.hasChildNodes()||1<t.childNodes.length)throw console.error("HTML does not have a single root node",n),new Error("HTML must have a single root node");return i(t.childNodes[0])},fromTag:function(n,t){t=(t||document).createElement(n);return i(t)},fromText:function(n,t){t=(t||document).createTextNode(n);return i(t)},fromDom:i,fromPoint:function(n,t,e){return(null==(n=n.dom.elementFromPoint(t,e))?T:k(n)).map(i)}},L={" ":"nbsp","­":"shy"},q=c(L),H=c(L,!0),F=(v="",o(L,function(n){v&&(v+=","),v+="span.mce-"+n}),v),x="mce-nbsp",I=function(n){return'<span data-mce-bogus="1" class="mce-'+L[n]+'">'+n+"</span>"},U=function(n){var t=C(n);return 3===n.dom.nodeType&&void 0!==t&&q.test(t)},V=function(n,t){var e=[],n=function(n,t){for(var e=n.length,o=new Array(e),r=0;r<e;r++){var i=n[r];o[r]=t(i,r)}return o}(n.dom.childNodes,E.fromDom);return A(n,function(n){e=(e=t(n)?e.concat([n]):e).concat(V(n,t))}),e},B=function(n){return"span"===n.nodeName.toLowerCase()&&n.classList.contains("mce-nbsp-wrap")},P=function(i,n){n=V(E.fromDom(n),U);A(n,function(n){var t,e=n.dom.parentNode;if(B(e))e=E.fromDom(e),t=x,S(e)?e.dom.classList.add(t):D(e,t);else{for(var o,e=i.dom.encode(C(n)).replace(H,I),r=i.dom.create("div",null,e);o=r.lastChild;)i.dom.insertAfter(o,n.dom);i.dom.remove(n.dom)}})},_=function(o,n){n=o.dom.select(F,n);A(n,function(n){var t,e;B(n)?(t=E.fromDom(n),e=x,S(t)?t.dom.classList.remove(e):j(t,e),M(t)):o.dom.remove(n,!0)})},K=tinymce.util.Tools.resolve("tinymce.util.Delay");h.add("visualchars",function(n){l=n.getParam("visualchars_default_state",!1),t=l;var t,e,o,r,i,u,c,a,s,l={get:function(){return t},set:function(n){t=n}};return m(n,l),(e=n).ui.registry.addToggleButton("visualchars",{tooltip:"Show invisible characters",icon:"visualchars",onAction:function(){return e.execCommand("mceVisualChars")},onSetup:g(e,o=l)}),e.ui.registry.addToggleMenuItem("visualchars",{text:"Show invisible characters",icon:"visualchars",onAction:function(){return e.execCommand("mceVisualChars")},onSetup:g(e,o)}),r=n,i=l,u=K.debounce(function(){f(r)},300),!1!==r.getParam("forced_root_block")&&r.on("keydown",function(n){!0===i.get()&&(13===n.keyCode?f(r):u())}),r.on("remove",u.stop),a=l,(c=n).on("init",function(){d(c,a)}),s=l,{isEnabled:function(){return s.get()}}})}();