!function(){"use strict";function g(e){return e.getParam("pagebreak_split_block",!1)}function u(e){var a='<img src="'+n.transparentSrc+'" class="'+m+'" data-mce-resize="false" data-mce-placeholder />';return e?"<p>"+a+"</p>":a}var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),n=tinymce.util.Tools.resolve("tinymce.Env"),m="mce-pagebreak";e.add("pagebreak",function(e){var a,n,r,o,i,t,c;(a=e).addCommand("mcePageBreak",function(){a.insertContent(u(g(a)))}),(n=e).ui.registry.addButton("pagebreak",{icon:"page-break",tooltip:"Page break",onAction:function(){return n.execCommand("mcePageBreak")}}),n.ui.registry.addMenuItem("pagebreak",{text:"Page break",icon:"page-break",onAction:function(){return n.execCommand("mcePageBreak")}}),o=(r=e).getParam("pagebreak_separator","\x3c!-- pagebreak --\x3e"),i=function(){return g(r)},t=new RegExp(o.replace(/[\?\.\*\[\]\(\)\{\}\+\^\$\:]/g,function(e){return"\\"+e}),"gi"),r.on("BeforeSetContent",function(e){e.content=e.content.replace(t,u(i()))}),r.on("PreInit",function(){r.serializer.addNodeFilter("img",function(e){for(var a,n=e.length;n--;)if((t=(a=e[n]).attr("class"))&&-1!==t.indexOf(m)){var t=a.parent;if(r.schema.getBlockElements()[t.name]&&i()){t.type=3,t.value=o,t.raw=!0,a.remove();continue}a.type=3,a.value=o,a.raw=!0}})}),(c=e).on("ResolveName",function(e){"IMG"===e.target.nodeName&&c.dom.hasClass(e.target,m)&&(e.name="pagebreak")})})}();